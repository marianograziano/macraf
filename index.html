<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asistente de Ejercicios Orofaciales</title>
    <meta name="description"
        content="Aplicaci√≥n para asistir en ejercicios orofaciales con detecci√≥n facial en tiempo real">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <h1 class="logo">
                <svg class="logo-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
                    <path d="M8 14C8 14 9.5 16 12 16C14.5 16 16 14 16 14" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" />
                    <circle cx="9" cy="9" r="1" fill="currentColor" />
                    <circle cx="15" cy="9" r="1" fill="currentColor" />
                </svg>
                Asistente Orofacial
            </h1>
            <nav class="nav">
                <button class="nav-btn active" data-view="practice">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M15 10l-4 4-2-2" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2" />
                    </svg>
                    Practicar
                </button>
                <button class="nav-btn" data-view="exercises">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                    </svg>
                    Ejercicios
                </button>
                <button class="nav-btn" data-view="review">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 3v18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        <path d="M7 14l4-4 3 3 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                    </svg>
                    Revisar
                </button>
            </nav>
        </div>
    </header>

    <main class="main">
        <div class="container">
            <!-- Vista de Pr√°ctica -->
            <section id="practice-view" class="view active">
                <div class="practice-grid">
                    <!-- Panel de C√°mara -->
                    <div class="card camera-panel">
                        <div class="card-header">
                            <h2 class="card-title">C√°mara en Vivo</h2>
                            <div class="status-indicator" id="camera-status">
                                <span class="status-dot"></span>
                                <span class="status-text">Desconectada</span>
                            </div>
                        </div>
                        <div class="camera-container">
                            <video id="webcam" autoplay playsinline></video>
                            <canvas id="output-canvas"></canvas>
                            <div class="camera-placeholder" id="camera-placeholder">
                                <svg class="placeholder-icon" viewBox="0 0 24 24" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <rect x="2" y="5" width="20" height="14" rx="2" stroke="currentColor"
                                        stroke-width="2" />
                                    <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" />
                                    <circle cx="18" cy="8" r="1" fill="currentColor" />
                                </svg>
                                <p>Haz clic en "Iniciar C√°mara" para comenzar</p>
                            </div>
                        </div>
                        <div class="camera-controls">
                            <button class="btn btn-primary" id="start-camera">
                                <svg class="btn-icon" viewBox="0 0 24 24" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path d="M8 5v14l11-7z" fill="currentColor" />
                                </svg>
                                Iniciar C√°mara
                            </button>
                            <button class="btn btn-secondary" id="stop-camera" disabled>
                                <svg class="btn-icon" viewBox="0 0 24 24" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <rect x="6" y="6" width="12" height="12" fill="currentColor" />
                                </svg>
                                Detener C√°mara
                            </button>
                            <div class="zoom-control">
                                <span class="zoom-label">Zoom</span>
                                <input type="range" id="zoom-range" min="1" max="3" step="0.1" value="1" disabled>
                                <span class="zoom-value" id="zoom-value">1.0x</span>
                            </div>
                        </div>

                        <!-- Panel de Configuraci√≥n del Mesh -->
                        <details class="mesh-config-panel">
                            <summary class="mesh-config-header">
                                <svg class="config-icon" viewBox="0 0 24 24" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" />
                                    <path d="M12 1v6m0 6v6M23 12h-6m-6 0H1" stroke="currentColor" stroke-width="2" />
                                </svg>
                                Configuraci√≥n del Mesh
                            </summary>
                            <div class="mesh-config-content">
                                <!-- Configuraci√≥n de Labios -->
                                <div class="config-section">
                                    <h4 class="config-title">üíã Labios</h4>
                                    <div class="config-row">
                                        <label class="config-label">Color:</label>
                                        <input type="color" id="lips-color" class="color-picker" value="#00ffff">
                                    </div>
                                    <div class="config-row">
                                        <label class="config-label">Grosor:</label>
                                        <input type="range" id="lips-width" class="config-slider" min="0.5" max="5"
                                            step="0.5" value="2.5">
                                        <span class="config-value" id="lips-width-value">2.5</span>
                                    </div>
                                    <div class="config-row">
                                        <label class="config-label">Opacidad:</label>
                                        <input type="range" id="lips-opacity" class="config-slider" min="0" max="1"
                                            step="0.1" value="0.9">
                                        <span class="config-value" id="lips-opacity-value">0.9</span>
                                    </div>
                                </div>

                                <!-- Configuraci√≥n de Ojos -->
                                <div class="config-section">
                                    <h4 class="config-title">üëÅÔ∏è Ojos</h4>
                                    <div class="config-row">
                                        <label class="config-label">Color:</label>
                                        <input type="color" id="eye-color" class="color-picker" value="#00ff64">
                                    </div>
                                    <div class="config-row">
                                        <label class="config-label">Grosor:</label>
                                        <input type="range" id="eye-width" class="config-slider" min="0.5" max="5"
                                            step="0.5" value="1.5">
                                        <span class="config-value" id="eye-width-value">1.5</span>
                                    </div>
                                    <div class="config-row">
                                        <label class="config-label">Opacidad:</label>
                                        <input type="range" id="eye-opacity" class="config-slider" min="0" max="1"
                                            step="0.1" value="0.7">
                                        <span class="config-value" id="eye-opacity-value">0.7</span>
                                    </div>
                                </div>

                                <!-- Configuraci√≥n de Malla -->
                                <div class="config-section">
                                    <h4 class="config-title">üï∏Ô∏è Malla</h4>
                                    <div class="config-row">
                                        <label class="config-label">Color:</label>
                                        <input type="color" id="tesselation-color" class="color-picker" value="#00ff64">
                                    </div>
                                    <div class="config-row">
                                        <label class="config-label">Grosor:</label>
                                        <input type="range" id="tesselation-width" class="config-slider" min="0.1"
                                            max="3" step="0.1" value="0.5">
                                        <span class="config-value" id="tesselation-width-value">0.5</span>
                                    </div>
                                    <div class="config-row">
                                        <label class="config-label">Opacidad:</label>
                                        <input type="range" id="tesselation-opacity" class="config-slider" min="0"
                                            max="1" step="0.05" value="0.15">
                                        <span class="config-value" id="tesselation-opacity-value">0.15</span>
                                    </div>
                                </div>

                                <!-- Configuraci√≥n de Puntos -->
                                <div class="config-section">
                                    <h4 class="config-title">‚ö´ Puntos Clave</h4>
                                    <div class="config-row">
                                        <label class="config-label">Color:</label>
                                        <input type="color" id="points-color" class="color-picker" value="#00ff64">
                                    </div>
                                    <div class="config-row">
                                        <label class="config-label">Tama√±o:</label>
                                        <input type="range" id="point-size" class="config-slider" min="1" max="8"
                                            step="0.5" value="2">
                                        <span class="config-value" id="point-size-value">2</span>
                                    </div>
                                    <div class="config-row">
                                        <label class="config-label">Opacidad:</label>
                                        <input type="range" id="points-opacity" class="config-slider" min="0" max="1"
                                            step="0.1" value="0.9">
                                        <span class="config-value" id="points-opacity-value">0.9</span>
                                    </div>
                                </div>

                                <button class="btn btn-secondary btn-sm" id="reset-mesh-config">
                                    <svg class="btn-icon" viewBox="0 0 24 24" fill="none"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <path d="M3 12a9 9 0 019-9 9.75 9.75 0 016.74 2.74L21 8" stroke="currentColor"
                                            stroke-width="2" stroke-linecap="round" />
                                        <path d="M21 3v5h-5" stroke="currentColor" stroke-width="2"
                                            stroke-linecap="round" />
                                    </svg>
                                    Restaurar valores por defecto
                                </button>
                            </div>
                        </details>
                    </div>

                    <!-- Panel de Sesi√≥n -->
                    <div class="card session-panel">
                        <div class="card-header">
                            <h2 class="card-title">Sesi√≥n de Ejercicio</h2>
                        </div>
                        <div class="session-content">
                            <div class="exercise-selector">
                                <label for="exercise-select" class="form-label">Seleccionar Ejercicio</label>
                                <select id="exercise-select" class="form-select">
                                    <option value="">-- Selecciona un ejercicio --</option>
                                </select>
                            </div>

                            <div class="exercise-info" id="exercise-info" style="display: none;">
                                <div class="info-row">
                                    <span class="info-label">Duraci√≥n:</span>
                                    <span class="info-value" id="exercise-duration">--</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Descripci√≥n:</span>
                                    <span class="info-value" id="exercise-description">--</span>
                                </div>
                            </div>

                            <div class="session-timer" id="session-timer" style="display: none;">
                                <div class="timer-display">
                                    <span class="timer-value" id="timer-value">00:00</span>
                                    <span class="timer-label">/ <span id="timer-total">00:00</span></span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" id="progress-fill"></div>
                                </div>
                            </div>

                            <div class="metrics-display" id="metrics-display" style="display: none;">
                                <h3 class="metrics-title">M√©tricas Bucales</h3>
                                <div class="metric-item">
                                    <span class="metric-label">‚≠ï Boca Abierta:</span>
                                    <div class="metric-bar">
                                        <div class="metric-fill" id="mouth-opening-fill"></div>
                                    </div>
                                    <span class="metric-value" id="mouth-opening-value">0%</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">üî¥ Boca Cerrada:</span>
                                    <div class="metric-bar">
                                        <div class="metric-fill" id="mouth-closed-fill"></div>
                                    </div>
                                    <span class="metric-value" id="mouth-closed-value">0%</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">üëÑ Labios Fruncidos:</span>
                                    <div class="metric-bar">
                                        <div class="metric-fill" id="lip-pursing-fill"></div>
                                    </div>
                                    <span class="metric-value" id="lip-pursing-value">0%</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">ü´ß Mejillas Infladas:</span>
                                    <div class="metric-bar">
                                        <div class="metric-fill" id="cheeks-inflated-fill"></div>
                                    </div>
                                    <span class="metric-value" id="cheeks-inflated-value">0%</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">‚ÜîÔ∏è Mov. Lateral:</span>
                                    <div class="metric-bar">
                                        <div class="metric-fill" id="lateral-movement-fill"></div>
                                    </div>
                                    <span class="metric-value" id="lateral-movement-value">0%</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">üëÖ Lengua Visible:</span>
                                    <div class="metric-bar">
                                        <div class="metric-fill" id="tongue-visible-fill"></div>
                                    </div>
                                    <span class="metric-value" id="tongue-visible-value">0%</span>
                                </div>

                                <h3 class="metrics-title"
                                    style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--color-secondary);">
                                    Expresiones Faciales</h3>

                                <div class="metric-item">
                                    <span class="metric-label">üòä Sonrisa:</span>
                                    <div class="metric-bar">
                                        <div class="metric-fill" id="smile-fill"></div>
                                    </div>
                                    <span class="metric-value" id="smile-value">0%</span>
                                </div>

                                <div class="metric-item">
                                    <span class="metric-label">üëÅÔ∏è Ojo Izq:</span>
                                    <div class="metric-bar">
                                        <div class="metric-fill" id="left-eye-fill"></div>
                                    </div>
                                    <span class="metric-value" id="left-eye-value">0%</span>
                                </div>

                                <div class="metric-item">
                                    <span class="metric-label">üëÅÔ∏è Ojo Der:</span>
                                    <div class="metric-bar">
                                        <div class="metric-fill" id="right-eye-fill"></div>
                                    </div>
                                    <span class="metric-value" id="right-eye-value">0%</span>
                                </div>

                                <div class="metric-item">
                                    <span class="metric-label">ü§® Cejas:</span>
                                    <div class="metric-bar">
                                        <div class="metric-fill" id="eyebrows-fill"></div>
                                    </div>
                                    <span class="metric-value" id="eyebrows-value">0%</span>
                                </div>
                            </div>

                            <div class="session-controls">
                                <button class="btn btn-success" id="start-session" disabled>
                                    <svg class="btn-icon" viewBox="0 0 24 24" fill="none"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
                                        <circle cx="12" cy="12" r="3" fill="currentColor" />
                                    </svg>
                                    Iniciar Sesi√≥n
                                </button>
                                <button class="btn btn-warning" id="pause-session" disabled>
                                    <svg class="btn-icon" viewBox="0 0 24 24" fill="none"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <rect x="6" y="4" width="4" height="16" fill="currentColor" />
                                        <rect x="14" y="4" width="4" height="16" fill="currentColor" />
                                    </svg>
                                    Pausar
                                </button>
                                <button class="btn btn-danger" id="stop-session" disabled>
                                    <svg class="btn-icon" viewBox="0 0 24 24" fill="none"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <rect x="5" y="5" width="14" height="14" rx="2" fill="currentColor" />
                                    </svg>
                                    Detener
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Vista de Ejercicios -->
            <section id="exercises-view" class="view">
                <div class="exercises-header">
                    <h2 class="section-title">Mis Ejercicios</h2>
                    <div class="exercise-actions">
                        <button class="btn btn-secondary btn-sm" id="import-json">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12"
                                    stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" />
                            </svg>
                            Importar JSON
                        </button>
                        <button class="btn btn-secondary btn-sm" id="export-json">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"
                                    stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" />
                            </svg>
                            Exportar JSON
                        </button>
                        <button class="btn btn-primary" id="add-exercise">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2"
                                    stroke-linecap="round" />
                            </svg>
                            Nuevo Ejercicio
                        </button>
                    </div>
                </div>

                <div class="exercises-grid" id="exercises-grid">
                    <!-- Los ejercicios se cargar√°n din√°micamente -->
                </div>

                <!-- Input oculto para importar archivo -->
                <input type="file" id="json-file-input" accept=".json" style="display: none;">
            </section>

            <!-- Vista de Revisi√≥n -->
            <section id="review-view" class="view">
                <div class="review-header">
                    <h2 class="section-title">Historial de Sesiones</h2>
                    <div class="filter-controls">
                        <select id="filter-exercise" class="form-select">
                            <option value="">Todos los ejercicios</option>
                        </select>
                    </div>
                </div>

                <div class="sessions-list" id="sessions-list">
                    <!-- Las sesiones se cargar√°n din√°micamente -->
                </div>
            </section>
        </div>
    </main>

    <!-- Modal para Crear/Editar Ejercicio -->
    <div class="modal" id="exercise-modal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-title">Nuevo Ejercicio</h3>
                <button class="modal-close" id="close-modal">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                    </svg>
                </button>
            </div>
            <form id="exercise-form" class="modal-body">
                <div class="form-group">
                    <label for="exercise-name" class="form-label">Nombre del Ejercicio*</label>
                    <input type="text" id="exercise-name" class="form-input" placeholder="Ej: Apertura bucal m√°xima"
                        required>
                </div>

                <div class="form-group">
                    <label for="exercise-desc" class="form-label">Descripci√≥n</label>
                    <textarea id="exercise-desc" class="form-textarea" rows="3"
                        placeholder="Describe el ejercicio..."></textarea>
                </div>

                <div class="form-group">
                    <label for="exercise-duration-input" class="form-label">Duraci√≥n (segundos)*</label>
                    <input type="number" id="exercise-duration-input" class="form-input" min="10" max="600" value="60"
                        required>
                </div>

                <div class="form-group">
                    <label class="form-label">Tipo de Ejercicio*</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="exercise-type" value="mouth-opening" checked>
                            <span>Apertura Bucal</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="exercise-type" value="lateral-movement">
                            <span>Movimiento Lateral</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="exercise-type" value="combined">
                            <span>Combinado</span>
                        </label>
                    </div>
                </div>

                <input type="hidden" id="exercise-id">

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="cancel-exercise">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Guardar Ejercicio</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para Ver Detalles de Sesi√≥n -->
    <div class="modal" id="session-modal">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 class="modal-title">Detalles de la Sesi√≥n</h3>
                <button class="modal-close" id="close-session-modal">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div id="session-details">
                    <!-- Los detalles se cargar√°n din√°micamente -->
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils@0.3.1640029074/camera_utils.js"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils@0.3.1620248257/drawing_utils.js"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh@0.4.1633559619/face_mesh.js"
        crossorigin="anonymous"></script>
    <script src="facemesh.js"></script>
    <script src="exercises.js"></script>
    <script src="recorder.js"></script>
    <script src="review.js"></script>
    <script src="app.js"></script>
</body>

</html>